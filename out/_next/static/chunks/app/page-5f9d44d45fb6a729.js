(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4664:function(t,e,a){Promise.resolve().then(a.bind(a,5411))},5411:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return o}});var i=a(7437),l=a(8714);async function n(t,e,a){let i;switch(a.type){case l.fS.Attachment:if(Array.isArray(i=await t.getCellValue(a.id,e)))for(let l of i)l.file_token=l.token,l.url=await t.getAttachmentUrl(l.token,a.id,e);else i.file_token=i.token,i.url=await t.getAttachmentUrl(i.token,a.id,e);break;case l.fS.MultiSelect:i=(i=await t.getCellValue(a.id,e)).map(t=>t.text);break;default:i=await t.getCellString(a.id,e)}return i}async function r(t,e){let a=await t.getFieldMetaList(),i=[];for(let l of e){let e={};for(let i of a)e[i.name]=await n(t,l,i);e.larkId=l,i.push(e)}return i}var s=a(2265);function o(){let[t,e]=(0,s.useState)(!1),[a,n]=(0,s.useState)([]);async function o(){let{tableId:t,viewId:a}=await l.ws.base.getSelection();if(!t||!a)return;e(!0);let i=await l.ws.ui.selectRecordIdList(t,a),n=await l.ws.base.getActiveTable(),s=await r(n,i);try{for(let t of s){let e=await fetch("https://api.qingcd.com/lark/users/virtual",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json","X-lark-token":"dC1nMTA0MTRoYllTNjY0NTJMSVZHNVJKUExUVUhTQU9ORlJXTlVLSTRR"}}),a=await e.json();try{var o;let e=await n.getFieldByName("同步结果");e&&await e.setValue(t.larkId,null!==(o=a.payload)&&void 0!==o?o:a.describe),(e=await n.getFieldByName("最后同步时间"))&&await e.setValue(t.larkId,new Date().toLocaleString())}catch(t){}}}finally{e(!1)}}return(0,i.jsx)("main",{className:"min-h-screen",children:(0,i.jsx)("button",{className:"bg-indigo-500",onClick:o,disabled:t,children:"同步"})})}}},function(t){t.O(0,[802,527,971,938,744],function(){return t(t.s=4664)}),_N_E=t.O()}]);